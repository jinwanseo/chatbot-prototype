doctype html
html
    head
        title= title
        script(src="https://cdn.tailwindcss.com")
    body.flex.flex-col.w-screen.h-screen.items-center.bg-slate-900
        section.shadow.shadow-lg.p-6.flex.flex-col.gap-2.justify-center.h-screen.w-full
            h1.text-slate-300.text-center ëŒ€í™” ì£¼ì œ ì¶”ê°€ ë° ì‚­ì œ ðŸŽ‰
            div.flex.flex-row.gap-2.items-center.justify-start
                a.bg-sky-900.text-sky-50.text-xs.px-2.rounded(href=`/chat?chatId=1`) ëŒ€í™” í•˜ê¸°
                a.bg-teal-900.text-sky-50.text-xs.px-2.rounded(href=`/custom`) ëŒ€í™” ì„¤ì •
                a.a.bg-amber-900.text-sky-50.text-xs.px-2.rounded.cursor-pointer(href=`/topic`) ì£¼ì œ ì„¤ì •
                span.text-slate-300.text-xs.ml-auto ëŒ€í™” ì£¼ì œë¥¼ ì„¤ì •í•˜ë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ì„¤ì •í•  ìˆ˜ ìžˆì–´ìš”
            ul#messages.h-full.w-full.flex.flex-col.gap-5.bg-slate-800.text-sm.rounded.p-5.overflow-y-auto
                each topic, index in topics
                    li.bg-slate-700.rounded.p-2.mr-auto.text-teal-50.w-full(id=`topic-${index}`)
                        div.flex.flex-row.w-full.gap-5.text-xs.justify-between.px-3
                            div.flex.flex-col.gap-2
                                div.flex.flex-row.items.center
                                    span.w-14.my-auto ì£¼ì œ ì´ë¦„
                                    span= topic.title
                                if topic.group.length > 0
                                    div.flex.flex-row.items.center
                                        span.w-14.my-auto ì—°ê´€ ì£¼ì œ
                                        div.flex.flex-row.gap-2
                                            each group in topic.group
                                                span= group
                                div.flex.flex-row.items.center
                                    span.w-14.my-auto ë¬¸ë‹µ ê°œìˆ˜
                                    span= topic.count
                            div.flex.flex-row.gap-1.items-center
                                button.bg-amber-800.text-amber-50.p-2.rounded(onclick=`setTopic('${topic.title}')`) ì„¤ì •
                                button.bg-red-800.text-red-50.p-2.rounded(onclick=`deleteTopic('${index}','${topic.title}')`) ì‚­ì œ
            form(action="" onsubmit="addTopic(event)" class="flex flex-row gap-2 w-full")
                div.flex.flex-col.w-full.text-xs.gap-1
                    div.flex.flex-row.gap-2.items-center.justify-center
                        span.text-slate-300.text-center.w-10 ì£¼ì œ
                        input#title.bg-slate-800.border.border-slate-400.rounded.rounded-lg.w-full.text-slate-300.px-3.p-2(placeholder="ì¶”ê°€í•  ì£¼ì œ ì´ë¦„ì„ ìž…ë ¥í•´ì¤˜ìš”", type="text", name="topic", autocomplete="off")
                    div.flex.flex-row.gap-2.items-center.justify-center
                        span.text-slate-300.text-center.w-10 ì—°ê´€
                        select#group.bg-slate-800.border.border-slate-400.rounded.rounded-lg.w-full.text-slate-300.px-3.p-2(name="group", autocomplete="off")
                            option(value="") ì„ íƒ ì•ˆí•¨
                            each topic in topics
                                option(value=topic.title)= topic.title

                button.bg-sky-900.text-sky-50.p-3.text-xs.rounded.w-24(type="submit") ì €ìž¥
        script.
            const baseURL = window.location.origin;

            const setTopic = (title) => {
                window.location.href = `${baseURL}/topic/custom?title=${title}`;
            }

            const deleteTopic = async (index, title) => {
                const response = await fetch(`${baseURL}/topic/${title}`, {
                    method: "DELETE"
                });

                const {result, error} = await response.json();

                if (error) {
                    alert(error);
                    return;
                }


                document.getElementById(`topic-${index}`).remove();
                window.location.reload();
            }

            const addTopic = async () => {
                const title = document.getElementById('title').value;
                const group = document.getElementById('group').value;
                if (title === "") {
                    alert("í•„ìˆ˜ í•­ëª© ëª¨ë‘ ìž…ë ¥ í•´ì¤˜ìš”");
                    return;
                }

                fetch(`${baseURL}/topic`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        title,
                        group: group ? [group] : []
                    })
                }).then(d => d.json())
                    .then(res => {
                        if (res.error) alert(res.error)
                        else window.location.reload();
                    })

            }
